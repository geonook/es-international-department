# üö® CRITICAL OAUTH FIX GUIDE - IMMEDIATE ACTION REQUIRED

## ‚ö° **URGENT: Complete OAuth Callback Fix**

The OAuth callback issue requires **BOTH** environment AND Google Console updates to be resolved.

---

## üìã **STEP 1: Update Zeabur Environment Variables (IMMEDIATE)**

### **Required Changes in Zeabur Dashboard:**

1. **Navigate to your Zeabur project dashboard**
2. **Go to service settings ‚Üí Environment Variables**
3. **Update these two variables:**

```env
NEXTAUTH_URL=https://kcislk-infohub.zeabur.app
ALLOWED_ORIGINS=https://kcislk-infohub.zeabur.app
```

4. **Save changes and restart/redeploy the service**

---

## üîß **STEP 2: Update Google OAuth Console (CRITICAL)**

### **Google Cloud Console Configuration:**

1. **Navigate to Google Cloud Console**
   - Go to: https://console.developers.google.com/
   - Select your project: `KCISLK ESID Info Hub`

2. **Go to Credentials**
   - Navigate: `API & Services` ‚Üí `Credentials`
   - Find your OAuth 2.0 Client ID

3. **Update Authorized Redirect URIs**
   - Click on your OAuth 2.0 Client ID to edit
   - In "Authorized redirect URIs" section:
     
   **ADD NEW URI:**
   ```
   https://kcislk-infohub.zeabur.app/api/auth/callback/google
   ```
   
   **REMOVE OLD URI:**
   ```
   http://localhost:3001/api/auth/callback/google
   ```

4. **Save Changes**
   - Click "Save" button
   - Wait for propagation (may take 5-10 minutes)

---

## üß™ **STEP 3: Test Complete OAuth Flow**

### **Testing Checklist:**

1. **Access Login Page**
   ```
   https://kcislk-infohub.zeabur.app/login
   ```

2. **Click "Login with Google"**
   - Should redirect to Google OAuth consent screen
   - Grant permissions

3. **Verify Callback URL**
   - After Google consent, should redirect to:
   ```
   https://kcislk-infohub.zeabur.app/api/auth/callback/google?...
   ```
   - **NOT** to `http://localhost:3001`

4. **Complete Login**
   - Should successfully authenticate and redirect to dashboard
   - No more "Internal Server Error"

---

## üîç **STEP 4: Verification Points**

### **Success Indicators:**
- ‚úÖ OAuth callback redirects to production domain (`kcislk-infohub.zeabur.app`)
- ‚úÖ No "Internal Server Error" on login
- ‚úÖ Successful authentication and user session creation
- ‚úÖ Proper redirect to dashboard/homepage after login

### **Failure Signs:**
- ‚ùå Still redirecting to `localhost:3001`
- ‚ùå "redirect_uri_mismatch" error from Google
- ‚ùå "Internal Server Error" persists
- ‚ùå OAuth consent screen shows localhost in URL

---

## üÜò **TROUBLESHOOTING**

### **If OAuth Still Redirects to Localhost:**
1. **Check Google Console** - Ensure localhost URI is completely removed
2. **Check Zeabur Environment** - Verify `NEXTAUTH_URL` is correctly set
3. **Wait for Propagation** - Google OAuth changes take 5-10 minutes
4. **Clear Browser Cache** - Hard refresh browser cache

### **If "redirect_uri_mismatch" Error:**
1. **Verify exact URL match** in Google Console
2. **Check for typos** in domain names
3. **Ensure HTTPS** (not HTTP) in production URIs

### **If "Internal Server Error" Persists:**
1. **Check Zeabur logs** for specific error details
2. **Verify environment variables** are saved and applied
3. **Restart service** in Zeabur dashboard

---

## ‚è∞ **TIMELINE EXPECTATIONS**

- **Environment Variable Update**: Immediate (requires service restart)
- **Google OAuth Console Update**: 5-10 minutes propagation
- **Testing**: Can begin immediately after both updates complete

---

## üìû **VERIFICATION COMMANDS**

After completing both steps, test with:

```bash
# Check OAuth providers endpoint (should return 200, not 404)
curl https://kcislk-infohub.zeabur.app/api/auth/providers

# Test OAuth signin endpoint
curl https://kcislk-infohub.zeabur.app/api/auth/signin
```

---

**üî• CRITICAL: Both Zeabur environment AND Google Console updates must be completed for the fix to work!**

*Generated by Claude Code - Emergency OAuth Fix Guide*