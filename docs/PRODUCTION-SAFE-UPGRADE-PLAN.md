# Production Environment Safe Upgrade Plan | ç”Ÿç”¢ç’°å¢ƒå®‰å…¨å‡ç´šè¨ˆåŠƒ

> **ç”Ÿæˆæ™‚é–“**: 2025-09-07 20:55 UTC+8  
> **ç›®æ¨™ç’°å¢ƒ**: kcislk-infohub.zeabur.app  
> **ç•¶å‰ç‰ˆæœ¬**: v1.0.0 (ç©©å®šé‹è¡Œ)  
> **ç›®æ¨™ç‰ˆæœ¬**: v1.6.0 (å®Œæ•´åŠŸèƒ½)  
> **å‡ç´šé¡å‹**: é›¶åœæ©Ÿæ™‚é–“å‡ç´š (Zero-Downtime Upgrade)

## ğŸ“Š ç”Ÿç”¢ç’°å¢ƒç¾ç‹€åˆ†æ

### âœ… ç•¶å‰ç”Ÿç”¢ç’°å¢ƒç‹€æ…‹ (v1.0.0)
```json
{
  "status": "OK",
  "version": "1.0.0",
  "health": "å®Œå…¨æ­£å¸¸",
  "database": {
    "status": "healthy",
    "responseTime": "96ms",
    "data": {
      "users": 4,
      "events": 4, 
      "resources": 6
    }
  },
  "oauth": "âœ… Googleèªè­‰æ­£å¸¸å·¥ä½œ",
  "api": "âœ… æ‰€æœ‰ç«¯é»æ­£å¸¸éŸ¿æ‡‰"
}
```

### ğŸ¯ å‡ç´šç›®æ¨™ (v1.6.0)
- **æ–°å¢åŠŸèƒ½**: /api/auth/providersç«¯é»
- **ç³»çµ±å„ªåŒ–**: æ”¹é€²çš„éŒ¯èª¤è™•ç†å’Œæ€§èƒ½
- **å®‰å…¨å¢å¼·**: æœ€æ–°å®‰å…¨ä¿®å¾©
- **UIæ”¹é€²**: å„ªåŒ–ç”¨æˆ¶ç•Œé¢å’Œé«”é©—

## ğŸ›¡ï¸ é¢¨éšªè©•ä¼°èˆ‡æ§åˆ¶

### ğŸŸ¢ ä½é¢¨éšªå› ç´ 
- **è³‡æ–™åº«å…¼å®¹**: v1.6.0å®Œå…¨å‘å¾Œå…¼å®¹
- **APIç©©å®š**: æ‰€æœ‰ç¾æœ‰ç«¯é»ä¿æŒä¸è®Š
- **OAuthé…ç½®**: ç„¡éœ€æ›´æ”¹ç¾æœ‰Googleè¨­ç½®
- **ç”¨æˆ¶æ•¸æ“š**: é›¶æ•¸æ“šé·ç§»éœ€æ±‚

### ğŸŸ¡ ä¸­ç­‰é¢¨éšªå› ç´ 
- **æ–°åŠŸèƒ½**: /api/auth/providersæ˜¯æ–°å¢ç«¯é»
- **ä¾è³´æ›´æ–°**: éƒ¨åˆ†npmåŒ…ç‰ˆæœ¬æ›´æ–°
- **ç’°å¢ƒè®Šæ•¸**: æ–°å¢APP_VERSIONè®Šæ•¸

### ğŸ”´ éœ€è¦ç‰¹åˆ¥æ³¨æ„
- **éƒ¨ç½²æ™‚æ©Ÿ**: é¿é–‹ä½¿ç”¨é«˜å³°æœŸ
- **å›æ»¾æº–å‚™**: ç¢ºä¿å¯ä»¥å¿«é€Ÿå›æ»¾
- **ç›£æ§åŠ å¼·**: å‡ç´šå¾Œå¯†åˆ‡ç›£æ§

## ğŸš€ ä¸‰éšæ®µå®‰å…¨å‡ç´šç­–ç•¥

### Phase 1: æº–å‚™éšæ®µ (Pre-Deployment)

#### æ­¥é©Ÿ1.1: ç¢ºèªStagingç’°å¢ƒç©©å®š
```bash
# ç¢ºä¿Stagingç’°å¢ƒå·²ä¿®å¾©ä¸¦é‹è¡Œv1.6.0
curl -s https://next14-landing.zeabur.app/api/health | jq '.version'
# å¿…é ˆè¿”å›: "1.6.0"

# æ¸¬è©¦æ‰€æœ‰é—œéµåŠŸèƒ½
curl -s https://next14-landing.zeabur.app/api/auth/providers
curl -s https://next14-landing.zeabur.app/api/public/info
# ç¢ºä¿éƒ½æ­£å¸¸å·¥ä½œ
```

#### æ­¥é©Ÿ1.2: ç”Ÿç”¢ç’°å¢ƒé æª¢æŸ¥
```bash
# è¨˜éŒ„ç•¶å‰ç”Ÿç”¢ç‹€æ…‹ä½œç‚ºåŸºç·š
curl -s https://kcislk-infohub.zeabur.app/api/health > production_baseline.json

# ç¢ºèªè³‡æ–™åº«ç•¶å‰ç‹€æ…‹
echo "ç•¶å‰ç”Ÿç”¢æ•¸æ“šé‡:"
curl -s https://kcislk-infohub.zeabur.app/api/health | jq '.performance.database.counts'
```

#### æ­¥é©Ÿ1.3: å‚™ä»½èˆ‡å›æ»¾æº–å‚™
- **ä»£ç¢¼å‚™ä»½**: ç¢ºèªGitHubå€‰åº«åŒæ­¥
- **é…ç½®å‚™ä»½**: è¨˜éŒ„Zeaburç’°å¢ƒè®Šæ•¸è¨­ç½®
- **è³‡æ–™åº«å‚™ä»½**: åŸ·è¡Œè³‡æ–™åº«å¿«ç…§ (å¦‚æœå¯ç”¨)

### Phase 2: éƒ¨ç½²éšæ®µ (Deployment)

#### æ­¥é©Ÿ2.1: æœ€ä½³éƒ¨ç½²æ™‚æ©Ÿ
- **å»ºè­°æ™‚é–“**: é€±æœ«æˆ–æ·±å¤œ (ä½¿ç”¨é‡æœ€ä½)
- **é¿é–‹æ™‚é–“**: é€±ä¸€è‡³é€±äº” 8:00-18:00
- **æº–å‚™æ™‚é–“**: è‡³å°‘2å°æ™‚çš„ç›£æ§çª—å£

#### æ­¥é©Ÿ2.2: Zeaburéƒ¨ç½²æ“ä½œ
```bash
# 1. ç™»å…¥Zeaburæ§åˆ¶å°
# 2. é¸æ“‡Productioné …ç›®: kcislk-infohub  
# 3. æª¢æŸ¥ç•¶å‰éƒ¨ç½²ç‹€æ…‹
# 4. è§¸ç™¼é‡æ–°éƒ¨ç½² (å°‡è‡ªå‹•æ‹‰å–æœ€æ–°mainåˆ†æ”¯)
# 5. ç›£æ§éƒ¨ç½²æ—¥èªŒç¢ºä¿ç„¡éŒ¯èª¤
```

#### æ­¥é©Ÿ2.3: ç’°å¢ƒè®Šæ•¸æ›´æ–°
ç¢ºä¿ç”Ÿç”¢ç’°å¢ƒåŒ…å«ä»¥ä¸‹æ–°è®Šæ•¸ï¼š
```env
# æ–°å¢çš„ç‰ˆæœ¬æ¨™è¨˜
APP_VERSION=1.6.0

# ç¢ºèªç¾æœ‰é‡è¦è®Šæ•¸
NODE_ENV=production
NEXTAUTH_URL=https://kcislk-infohub.zeabur.app
DATABASE_URL=postgresql://... (ä¿æŒä¸è®Š)
GOOGLE_CLIENT_ID=... (ä¿æŒä¸è®Š)
GOOGLE_CLIENT_SECRET=... (ä¿æŒä¸è®Š)
```

### Phase 3: é©—è­‰éšæ®µ (Post-Deployment)

#### æ­¥é©Ÿ3.1: å³æ™‚å¥åº·æª¢æŸ¥ (éƒ¨ç½²å¾Œ0-5åˆ†é˜)
```bash
# åŸºæœ¬é€£é€šæ€§æ¸¬è©¦
curl -s -o /dev/null -w "HTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" https://kcislk-infohub.zeabur.app/

# ç‰ˆæœ¬ç¢ºèª
curl -s https://kcislk-infohub.zeabur.app/api/health | jq '.version'
# æœŸæœ›: "1.6.0"

# è³‡æ–™åº«é€£æ¥æ¸¬è©¦
curl -s https://kcislk-infohub.zeabur.app/api/health | jq '.performance.database.status'
# æœŸæœ›: "healthy"
```

#### æ­¥é©Ÿ3.2: åŠŸèƒ½å®Œæ•´æ€§æ¸¬è©¦ (éƒ¨ç½²å¾Œ5-15åˆ†é˜)
```bash
# æ¸¬è©¦æ–°å¢çš„OAuth providersç«¯é»
curl -s https://kcislk-infohub.zeabur.app/api/auth/providers | jq 'keys'
# æœŸæœ›: ["google"]

# æ¸¬è©¦Google OAuthæµç¨‹
curl -s -o /dev/null -w "%{http_code}" https://kcislk-infohub.zeabur.app/api/auth/google
# æœŸæœ›: 302

# æ¸¬è©¦è³‡æ–™å®Œæ•´æ€§
curl -s https://kcislk-infohub.zeabur.app/api/public/info | jq '.success'
# æœŸæœ›: true
```

#### æ­¥é©Ÿ3.3: ç”¨æˆ¶é«”é©—æ¸¬è©¦ (éƒ¨ç½²å¾Œ15-30åˆ†é˜)
- **ä¸»é è¼‰å…¥**: ç¢ºèªé é¢æ­£å¸¸é¡¯ç¤º
- **OAuthç™»å…¥**: å®Œæ•´æ¸¬è©¦Googleç™»å…¥æµç¨‹
- **æ¬Šé™ç³»çµ±**: ç¢ºèªä¸‰å±¤æ¬Šé™æ­£å¸¸å·¥ä½œ
- **è³‡æ–™é¡¯ç¤º**: ç¢ºèªeventså’Œresourcesæ­£å¸¸è¼‰å…¥

## ğŸ”§ ç›£æ§èˆ‡è­¦å ±è¨­ç½®

### é—œéµæŒ‡æ¨™ç›£æ§
```bash
# è‡ªå‹•åŒ–ç›£æ§è…³æœ¬
#!/bin/bash
# production-health-monitor.sh

while true; do
    VERSION=$(curl -s https://kcislk-infohub.zeabur.app/api/health | jq -r '.version')
    STATUS=$(curl -s https://kcislk-infohub.zeabur.app/api/health | jq -r '.status')
    DB_STATUS=$(curl -s https://kcislk-infohub.zeabur.app/api/health | jq -r '.performance.database.status')
    
    echo "$(date): Version=$VERSION, Status=$STATUS, DB=$DB_STATUS"
    
    if [ "$VERSION" != "1.6.0" ] || [ "$STATUS" != "OK" ] || [ "$DB_STATUS" != "healthy" ]; then
        echo "ğŸš¨ WARNING: Production health check failed!"
        # ç™¼é€è­¦å ±é€šçŸ¥
    fi
    
    sleep 60  # æ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡
done
```

## ğŸ”™ ç·Šæ€¥å›æ»¾ç¨‹åº

### å›æ»¾è§¸ç™¼æ¢ä»¶
- HTTP 5xxéŒ¯èª¤æŒçºŒè¶…é2åˆ†é˜
- è³‡æ–™åº«é€£æ¥å¤±æ•—
- OAuthèªè­‰å®Œå…¨ç„¡æ³•å·¥ä½œ
- ç”¨æˆ¶ç„¡æ³•æ­£å¸¸è¨ªå•ç¶²ç«™

### å¿«é€Ÿå›æ»¾æ­¥é©Ÿ
```bash
# 1. åœ¨Zeaburæ§åˆ¶å°ä¸­
#    - æ‰¾åˆ°Productionéƒ¨ç½²æ­·å²
#    - é¸æ“‡ä¸Šä¸€å€‹ç©©å®šç‰ˆæœ¬
#    - é»æ“Š"Rollback"

# 2. ç¢ºèªå›æ»¾æˆåŠŸ
curl -s https://kcislk-infohub.zeabur.app/api/health | jq '.version'
# æ‡‰è©²å›åˆ°: "1.0.0"

# 3. é€šçŸ¥ç›¸é—œäººå“¡å›æ»¾å·²å®Œæˆ
```

## ğŸ“… å‡ç´šæ™‚é–“è¡¨å»ºè­°

### ç¬¬1é€±: æº–å‚™é€±
- **é€±ä¸€-é€±ä¸‰**: Stagingç’°å¢ƒä¿®å¾©å’Œæ¸¬è©¦
- **é€±å››-é€±äº”**: ç”Ÿç”¢å‡ç´šæº–å‚™å’Œæ–‡æª”
- **é€±æœ«**: å‡ç´šé æ¼”å’Œåœ˜éšŠåŒæ­¥

### ç¬¬2é€±: åŸ·è¡Œé€±
- **é€±å…­æ·±å¤œ 02:00-04:00**: åŸ·è¡Œç”Ÿç”¢å‡ç´š
- **é€±æ—¥**: å¯†é›†ç›£æ§å’Œé©—è­‰
- **é€±ä¸€**: æ­£å¸¸æœå‹™ç¢ºèª

## âœ… å‡ç´šæˆåŠŸæ¨™æº–

### å¿…é ˆé”æˆçš„æŒ‡æ¨™
- [ ] âœ… ç¶²ç«™æ­£å¸¸è¨ªå• (HTTP 200)
- [ ] âœ… ç‰ˆæœ¬é¡¯ç¤ºç‚ºv1.6.0
- [ ] âœ… è³‡æ–™åº«å¥åº·ç‹€æ…‹
- [ ] âœ… OAuthå®Œæ•´åŠŸèƒ½
- [ ] âœ… æ‰€æœ‰ç¾æœ‰æ•¸æ“šä¿æŒå®Œæ•´
- [ ] âœ… æ–°åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### æ€§èƒ½æ¨™æº–
- [ ] âœ… ä¸»é éŸ¿æ‡‰æ™‚é–“ <500ms
- [ ] âœ… APIéŸ¿æ‡‰æ™‚é–“ <200ms  
- [ ] âœ… è³‡æ–™åº«æŸ¥è©¢æ™‚é–“ <100ms
- [ ] âœ… é›¶5xxéŒ¯èª¤

## ğŸ“ å‡ç´šæ”¯æ´åœ˜éšŠ

### å‡ç´šæœŸé–“è¯çµ¡è³‡è¨Š
- **æŠ€è¡“è² è²¬äºº**: æº–å‚™24å°æ™‚å¾…å‘½
- **Zeaburå¹³å°æ”¯æ´**: discord.gg/zeabur
- **GitHub Issues**: github.com/geonook/es-international-department/issues

### å‡ç´šå¾Œè¿½è¹¤
- **ç¬¬1å¤©**: æ¯å°æ™‚å¥åº·æª¢æŸ¥
- **ç¬¬2-7å¤©**: æ¯4å°æ™‚æª¢æŸ¥
- **ç¬¬2é€±**: æ¯æ—¥æª¢æŸ¥
- **ç¬¬3-4é€±**: æ¯é€±æª¢æŸ¥

## ğŸ“ å‡ç´šè¨˜éŒ„æ¨¡æ¿

```markdown
# ç”Ÿç”¢ç’°å¢ƒå‡ç´šè¨˜éŒ„ - v1.0.0 â†’ v1.6.0

**å‡ç´šæ—¥æœŸ**: ____å¹´__æœˆ__æ—¥
**åŸ·è¡Œäººå“¡**: ________________
**é–‹å§‹æ™‚é–“**: __:__ UTC+8
**å®Œæˆæ™‚é–“**: __:__ UTC+8

## åŸ·è¡Œæª¢æŸ¥æ¸…å–®
- [ ] Stagingç’°å¢ƒé©—è­‰é€šé
- [ ] å‚™ä»½å®Œæˆç¢ºèª
- [ ] Zeaburéƒ¨ç½²åŸ·è¡Œ
- [ ] ç’°å¢ƒè®Šæ•¸æ›´æ–°
- [ ] å¥åº·æª¢æŸ¥é€šé
- [ ] åŠŸèƒ½æ¸¬è©¦å®Œæˆ
- [ ] ç”¨æˆ¶é©—æ”¶æ¸¬è©¦

## é‡åˆ°å•é¡Œ
ç„¡ / [è¨˜éŒ„ä»»ä½•å•é¡Œ]

## å›æ»¾æƒ…æ³
ç„¡éœ€å›æ»¾ / [è¨˜éŒ„å›æ»¾åŸå› å’Œéç¨‹]

## å‡ç´šç¸½çµ
[è¨˜éŒ„å‡ç´šæˆåŠŸç¢ºèªå’Œé—œéµè§€å¯Ÿ]
```

---
*å®‰å…¨å‡ç´šè¨ˆåŠƒç”Ÿæˆæ™‚é–“: 2025-09-07 20:55 UTC+8*  
*ä¸‹ä¸€æ­¥: å»ºç«‹è‡ªå‹•åŒ–ç‰ˆæœ¬ç›£æ§ç³»çµ±*